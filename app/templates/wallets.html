{% extends "base.html" %}

{% block title %}Wallets - Financial Tracker{% endblock %}

{% block content %}
<div class="card">
    <div class="flex justify-between items-center mb-8">
        <h1>My Wallets</h1>
        <a href="{{ url_for('main.add_wallet') }}">
            <button>+ Add Wallet</button>
        </a>
    </div>

    <div class="grid-wallets">
        {% for wallet in wallets %}
        <div class="card wallet-card">
            <div class="wallet-icon">{{ wallet.icon }}</div>
            <h3 class="wallet-name">{{ wallet.name }}</h3>
            <p class="wallet-type">{{ wallet.wallet_type|title }}{% if wallet.is_shared %} ‚Ä¢ Shared{% endif %}</p>
            {% if wallet.account_number %}
            <p class="wallet-account">Acct: {{ wallet.account_number }}</p>
            {% else %}
            <div class="wallet-spacer"></div>
            {% endif %}
            <div class="wallet-balance">{{ wallet.currency }} {{ "%.2f"|format(wallet.balance) }}</div>
            <p class="wallet-label">Current Balance</p>
            
            <div class="wallet-actions">
                <a href="{{ url_for('main.edit_wallet', id=wallet.id) }}" class="btn-edit action-link" style="text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
                    ‚úèÔ∏è Edit
                </a>
                <button class="delete-wallet-btn btn-delete" data-id="{{ wallet.id }}" data-name="{{ wallet.name }}">
                    üóëÔ∏è Delete
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not wallets %}
        <p>No wallets yet. Create your first wallet to start tracking!</p>
    {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteWalletModal" class="modal-backdrop">
    <div class="modal-content" style="max-width: 400px;">
        <h3 class="text-danger" style="margin-top: 0; margin-bottom: 1rem;">‚ö†Ô∏è Delete Wallet</h3>
        <p id="deleteWalletMessage" class="text-muted" style="margin-bottom: 1.5rem;"></p>
        <div class="flex gap-4 justify-end">
            <button onclick="hideDeleteWalletDialog()" class="btn-secondary">
                Cancel
            </button>
            <button onclick="confirmDeleteWallet()" class="btn-danger">
                Delete
            </button>
        </div>
    </div>
</div>

<form id="deleteWalletForm" method="POST" style="display: none;">
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let walletToDelete = null;
    const deleteModal = document.getElementById('deleteWalletModal');
    const deleteMessage = document.getElementById('deleteWalletMessage');
    const deleteForm = document.getElementById('deleteWalletForm');

    // Attach click handlers to all delete buttons
    document.querySelectorAll('.delete-wallet-btn').forEach(button => {
        button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');
            walletToDelete = id;
            deleteMessage.textContent = `Are you sure you want to delete the wallet "${name}"? This action cannot be undone.`;
            deleteModal.style.display = 'flex';
        });
    });

    window.hideDeleteWalletDialog = function() {
        deleteModal.style.display = 'none';
        walletToDelete = null;
    };

    window.confirmDeleteWallet = function() {
        if (walletToDelete) {
            deleteForm.action = `/wallets/delete/${walletToDelete}`;
            deleteForm.submit();
        }
    };

    // Close modal when clicking outside
    deleteModal.addEventListener('click', function(e) {
        if (e.target === this) {
            hideDeleteWalletDialog();
        }
    });
});
</script>
{% endblock %}
