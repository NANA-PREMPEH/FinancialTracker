{% extends "base.html" %}

{% block title %}Add Wallet - Financial Tracker{% endblock %}

{% block content %}
<div class="card">
    <h1>Add New Wallet</h1>

    <form method="POST" style="max-width: 30rem;">
        <div class="form-group">
            <label for="name">Wallet Name</label>
            <input type="text" id="name" name="name" placeholder="e.g., Cash, Bank Account" required>
        </div>

        <div class="form-group">
            <label for="balance">Initial Balance</label>
            <input type="number" id="balance" name="balance" step="0.01" min="0" value="0.00" placeholder="0.00" required>
        </div>

        <div class="form-group">
            <label>Currency Type</label>
            <div style="display: flex; gap: 1rem; margin-bottom: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="currency_type" value="local" checked onclick="toggleCurrencySelect()">
                    Local Currency (GHS)
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="currency_type" value="foreign" onclick="toggleCurrencySelect()">
                    Foreign Currency
                </label>
            </div>
            
            <div id="currency_select_group" style="display: none;">
                <label for="currency">Select Currency</label>
                <select id="currency" name="currency" style="width: 100%;">
                    {% for code, name in currencies.items() %}
                    <option value="{{ code }}" {% if code == 'GHS' %}selected{% endif %}>{{ code }} - {{ name }}</option>
                    {% endfor %}
                </select>
            </div>
            <!-- Hidden input to submit GHS when local is selected, effectively -->
            <!-- Actually, if local is selected, we should ensure 'currency' input submits GHS. 
                 The easiest way is to have the select always present but modify its value or disable/hide it.
                 If I hide it, I still need to submit 'currency'.
                 Better: If Local, set select value to GHS and hide parent div. If Foreign, show div. 
            -->
        </div>

        <script>
            function toggleCurrencySelect() {
                const isLocal = document.querySelector('input[name="currency_type"][value="local"]').checked;
                const currencyGroup = document.getElementById('currency_select_group');
                const currencySelect = document.getElementById('currency');
                
                if (isLocal) {
                    currencyGroup.style.display = 'none';
                    currencySelect.value = 'GHS';
                } else {
                    currencyGroup.style.display = 'block';
                }
            }
            
            // Run on load
            document.addEventListener('DOMContentLoaded', toggleCurrencySelect);
        </script>

        <div class="form-group">
            <label for="wallet_type">Wallet Type</label>
            <select id="wallet_type" name="wallet_type" onchange="toggleAccountNumber()">
                <option value="cash">üíµ Cash</option>
                <option value="bank">üè¶ Bank Account</option>
                <option value="mobile_money">üì± Mobile Money</option>
                <option value="crypto">‚Çø Crypto Wallet</option>
                <option value="ewallet">üí≥ E-Wallet</option>
            </select>
        </div>

        <div class="form-group" id="account_number_group" style="display: none;">
            <label for="account_number" id="account_number_label">Account Number</label>
            <input type="text" id="account_number" name="account_number" placeholder="Enter account number">
        </div>

        <script>
            function toggleAccountNumber() {
                const walletType = document.getElementById('wallet_type').value;
                const accountGroup = document.getElementById('account_number_group');
                const accountLabel = document.getElementById('account_number_label');
                const accountInput = document.getElementById('account_number');

                if (walletType === 'bank') {
                    accountGroup.style.display = 'block';
                    accountLabel.textContent = 'Bank Account Number';
                    accountInput.placeholder = 'Enter bank account number';
                } else if (walletType === 'mobile_money') {
                    accountGroup.style.display = 'block';
                    accountLabel.textContent = 'Mobile Money Number';
                    accountInput.placeholder = 'Enter mobile money number';
                } else {
                    accountGroup.style.display = 'none';
                }
            }

            // Initialize on load
            document.addEventListener('DOMContentLoaded', function() {
                toggleAccountNumber();
            });
        </script>

        <div class="form-group">
            <label for="icon">Icon</label>
            <input type="text" id="icon" name="icon" value="üí∞" maxlength="2">
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="is_shared">
                Shared Wallet (for families/couples)
            </label>
        </div>

        <button type="submit">Create Wallet</button>
    </form>
</div>
{% endblock %}
